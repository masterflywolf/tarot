import{_ as s,W as o,V as e,G as a,Z as t,o as r,c as i,w as n,f as l,d,e as u,C as c,D as p,i as m,q as f,v as w,a4 as h}from"./index-6d8df4d2.js";import{_ as g}from"./uni-match-media.b826d6d2.js";import{_ as P}from"./uni-easyinput.b407beea.js";import{_}from"./uni-forms-item.5a5358a6.js";import{_ as y}from"./uni-id-pages-sms-form.8a3c9289.js";import{_ as D}from"./uni-forms.8754e8fd.js";import{_ as b}from"./uni-popup-captcha.614bf975.js";import{p as k}from"./password.90dccabb.js";import{s as I,m as C}from"./store.682ebf55.js";import"./uni-captcha.af867944.js";import"./uni-popup.4ce3ad51.js";const V=o.importObject("uni-id-co",{customUI:!0});const j=s({name:"set-pwd.vue",data:()=>({uniIdRedirectUrl:"",loginType:"",logo:"/static/logo.png",focusNewPassword:!1,focusNewPassword2:!1,allowSkip:!1,formData:{code:"",captcha:"",newPassword:"",newPassword2:""},rules:k.getPwdRules("newPassword","newPassword2")}),computed:{userInfo:()=>I.userInfo},onReady(){this.$refs.form.setRules(this.rules)},onLoad(s){var o;this.uniIdRedirectUrl=s.uniIdRedirectUrl,this.loginType=s.loginType,e.setPasswordAfterLogin&&(null==(o=e.setPasswordAfterLogin)?void 0:o.allowSkip)&&(this.allowSkip=!0)},methods:{submit(){if(!/^\d{6}$/.test(this.formData.code))return this.$refs.smsCode.focusSmsCodeInput=!0,a({title:"验证码格式不正确",icon:"none"});this.$refs.form.validate().then((s=>{V.setPwd({password:this.formData.newPassword,code:this.formData.code,captcha:this.formData.captcha}).then((s=>{t({content:"密码设置成功",showCancel:!1,success:()=>{C.loginBack({uniIdRedirectUrl:this.uniIdRedirectUrl,loginType:this.loginType})}})})).catch((s=>{t({content:s.message,showCancel:!1})}))})).catch((s=>{"uni-id-captcha-required"==s.errCode?this.$refs.popup.open():console.log(s.errMsg)})).finally((s=>{this.formData.captcha=""}))},skip(){C.loginBack({uniIdRedirectUrl:this.uniIdRedirectUrl})}}},[["render",function(s,o,e,a,t,k){const I=p,C=l,V=m,j=f(w("uni-match-media"),g),U=f(w("uni-easyinput"),P),R=f(w("uni-forms-item"),_),v=f(w("uni-id-pages-sms-form"),y),N=h,x=f(w("uni-forms"),D),B=f(w("uni-popup-captcha"),b);return r(),i(C,{class:"uni-content"},{default:n((()=>[d(j,{"min-width":690},{default:n((()=>[d(C,{class:"login-logo"},{default:n((()=>[d(I,{src:t.logo},null,8,["src"])])),_:1}),d(V,{class:"title title-box"},{default:n((()=>[u("设置密码")])),_:1})])),_:1}),d(x,{class:"set-password-form",ref:"form",value:t.formData,"err-show-type":"toast"},{default:n((()=>[d(V,{class:"tip"},{default:n((()=>[u("输入密码")])),_:1}),d(R,{name:"newPassword"},{default:n((()=>[d(U,{focus:t.focusNewPassword,onBlur:o[0]||(o[0]=s=>t.focusNewPassword=!1),class:"input-box",type:"password",inputBorder:!1,modelValue:t.formData.newPassword,"onUpdate:modelValue":o[1]||(o[1]=s=>t.formData.newPassword=s),placeholder:"请输入密码"},null,8,["focus","modelValue"])])),_:1}),d(V,{class:"tip"},{default:n((()=>[u("再次输入密码")])),_:1}),d(R,{name:"newPassword2"},{default:n((()=>[d(U,{focus:t.focusNewPassword2,onBlur:o[2]||(o[2]=s=>t.focusNewPassword2=!1),class:"input-box",type:"password",inputBorder:!1,modelValue:t.formData.newPassword2,"onUpdate:modelValue":o[3]||(o[3]=s=>t.formData.newPassword2=s),placeholder:"请再次输入新密码"},null,8,["focus","modelValue"])])),_:1}),d(v,{modelValue:t.formData.code,"onUpdate:modelValue":o[4]||(o[4]=s=>t.formData.code=s),type:"set-pwd-by-sms",ref:"smsCode",phone:k.userInfo.mobile},null,8,["modelValue","phone"]),d(C,{class:"link-box"},{default:n((()=>[d(N,{class:"uni-btn send-btn",type:"primary",onClick:k.submit},{default:n((()=>[u("确认")])),_:1},8,["onClick"]),t.allowSkip?(r(),i(N,{key:0,class:"uni-btn send-btn",type:"default",onClick:k.skip},{default:n((()=>[u("跳过")])),_:1},8,["onClick"])):c("",!0)])),_:1})])),_:1},8,["value"]),d(B,{onConfirm:k.submit,modelValue:t.formData.captcha,"onUpdate:modelValue":o[5]||(o[5]=s=>t.formData.captcha=s),scene:"set-pwd-by-sms",ref:"popup"},null,8,["onConfirm","modelValue"])])),_:1})}],["__scopeId","data-v-f34b7681"]]);export{j as default};
